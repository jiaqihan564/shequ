# 🚀 快速部署到宝塔 Nginx

## 一、打包前端项目

### Windows 用户
双击运行 `deploy.bat` 脚本，或在命令行中执行：
```bash
deploy.bat
```

### Linux/Mac 用户
```bash
chmod +x deploy.sh
./deploy.sh
```

脚本会自动：
- ✅ 打包 dist 目录
- ✅ 复制 Nginx 配置文件
- ✅ 复制部署文档
- ✅ 创建日志目录
- ✅ 压缩成 `.zip` 或 `.tar.gz` 文件

---

## 二、上传到服务器

### 方法 1：宝塔面板上传（最简单）

1. 登录宝塔面板
2. 点击**文件**
3. 进入 `/www/wwwroot/` 目录
4. 点击**上传**，选择打包好的压缩包
5. 上传完成后，右键压缩包 → **解压**
6. 重命名解压后的文件夹为 `shequ-tech-community`

### 方法 2：SCP 上传（命令行）

```bash
# 上传压缩包（替换 YOUR_IP 为你的服务器IP）
scp shequ-frontend-*.tar.gz root@YOUR_IP:/www/wwwroot/

# SSH 连接到服务器
ssh root@YOUR_IP

# 解压
cd /www/wwwroot/
tar -xzf shequ-frontend-*.tar.gz
mv deploy_package shequ-tech-community
cd shequ-tech-community

# 设置权限
chmod -R 755 dist
chown -R www:www dist
```

---

## 三、配置 Nginx

### 在宝塔面板操作：

1. 点击**网站** → **添加站点**
   - 域名：填写你的公网 IP（如：`123.45.67.89`）
   - 根目录：`/www/wwwroot/shequ-tech-community/dist`
   - PHP：选择**纯静态**
   - 点击**提交**

2. 点击站点右侧的**设置** → **配置文件**

3. 打开服务器上的 `/www/wwwroot/shequ-tech-community/nginx.conf`，复制全部内容

4. 粘贴到配置文件编辑器中（**已配置为后端端口 3001，通常无需修改**）
   
   > 注意：配置文件中的后端端口已设置为 3001（与 `config.yaml` 一致）
   > 如果你的后端使用了其他端口，请修改这两处：
   ```nginx
   proxy_pass http://localhost:3001/api/;  # 修改为实际后端端口
   proxy_pass http://localhost:3001/ws/;   # 修改为实际后端端口
   ```

5. 点击**保存**

6. 重启 Nginx：
   - **软件商店** → **Nginx** → **设置** → **重载配置**

---

## 四、开放端口

### 宝塔防火墙
- **安全** → 确保端口 **80** 已放行

### 云服务器安全组（阿里云/腾讯云）
- 登录云控制台
- 安全组规则 → 添加：
  - 入站规则：TCP, 端口 80, 来源 0.0.0.0/0

---

## 五、访问测试

打开浏览器，访问：`http://你的公网IP`

例如：`http://123.45.67.89`

### 检查清单
- [ ] 页面能正常打开
- [ ] 样式和图片显示正常
- [ ] 可以登录/注册
- [ ] API 请求正常（F12 查看 Network）
- [ ] WebSocket 连接正常（如果有聊天功能）

---

## ⚠️ 常见问题

### 1. 访问 IP 显示 404
- 检查 Nginx 配置中的 `root` 路径是否正确
- 确认 `/www/wwwroot/shequ-tech-community/dist/index.html` 文件存在

### 2. 页面空白
- 按 F12 查看控制台错误
- 检查静态资源是否加载成功（Network 标签）
- 查看 Nginx 错误日志：`/www/wwwroot/shequ-tech-community/logs/error.log`

### 3. API 请求失败
- 确认后端服务正在运行：`ps aux | grep shequ_gin`
- 检查后端端口：`netstat -tlnp | grep 3001`（后端默认端口是 3001）
- 确认 Nginx 配置中的 `proxy_pass` 地址正确
- 查看后端日志：`tail -f /path/to/shequ_gin/log/$(date +%Y-%m-%d)/app.log`

### 4. 刷新页面 404
- 确保 Nginx 配置中有 `try_files $uri $uri/ /index.html;`

---

## 📖 详细文档

如需更详细的说明，请查看：`宝塔部署指南.md`

---

## 🔄 更新部署

当有新版本时：

1. 重新运行 `deploy.bat` 或 `deploy.sh`
2. 上传新的压缩包
3. 备份旧的 dist：
   ```bash
   mv /www/wwwroot/shequ-tech-community/dist /www/wwwroot/shequ-tech-community/dist.bak
   ```
4. 解压新版本
5. 重启 Nginx：`nginx -s reload`

---

---

## 📚 其他文档

- **`宝塔部署指南.md`** - 详细的部署步骤和故障排查
- **`后端配置说明.md`** - 后端配置文件详细说明
- **`nginx.conf`** - Nginx 配置文件

---

## ⚠️ 重要提醒

**部署成功后，务必完成以下安全配置：**

1. ✅ 修改后端 `config.yaml` 中的 CORS 配置：
   ```yaml
   cors:
     allow_origins: ["http://你的公网IP"]
   ```

2. ✅ 修改后端 JWT 密钥（config.yaml）：
   ```yaml
   jwt:
     secret_key: "生成一个强随机字符串"
   ```

3. ✅ 修改数据库密码（config.yaml）

4. ✅ 修改管理员默认密码

5. ✅ 确保后端服务在 3001 端口运行

详见：**`后端配置说明.md`**

---

祝部署顺利！ 🎉

